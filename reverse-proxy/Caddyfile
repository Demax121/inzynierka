# Plik: reverse-proxy/Caddyfile
{
    local_certs
}

app.local {
    # Przekierowanie ruchu do kontenera frontendu (Vite dev server)
    reverse_proxy frontend:5173

    # Przekierowanie zapytań do API (backend PHP) na /api/*
    handle_path /api/* {
        uri strip_prefix /api
        reverse_proxy backend-server-caddy:80
    }
    
    # Przekierowanie zapytań do CDN na /assets/*
    handle_path /assets/* {
        uri strip_prefix /assets
        reverse_proxy cdn:80
    }

    # Przekierowanie zapytań do serwera WebSocket (bun-api)
    # Caddy potrafi zarządzać WebSocketami i przekierować je
    handle /ws {
        reverse_proxy bun-api:3000
    }
}