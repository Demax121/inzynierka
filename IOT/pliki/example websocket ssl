#include <Arduino.h>
#include <WiFi.h>
#include <WiFiClientSecure.h>
#include <WebSocketsClient.h>

WebSocketsClient webSocket;

#define USE_SERIAL Serial

// Funkcja obsługi zdarzeń WebSocket
void webSocketEvent(WStype_t type, uint8_t * payload, size_t length) {
    switch(type) {
        case WStype_DISCONNECTED:
            USE_SERIAL.println("[WSc] Disconnected!");
            break;

        case WStype_CONNECTED:
            USE_SERIAL.printf("[WSc] Connected to: %s\n", payload);
            webSocket.sendTXT("Hello from ESP32");
            break;

        case WStype_TEXT:
            USE_SERIAL.printf("[WSc] Received text: %s\n", payload);
            break;

        default:
            break;
    }
}

void setup() {
    USE_SERIAL.begin(115200);

    // Połączenie z Wi-Fi
    WiFi.begin("SSID", "PASSWORD");
    USE_SERIAL.print("Connecting to WiFi");
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        USE_SERIAL.print(".");
    }
    USE_SERIAL.println("\nWiFi connected");

    // Połączenie SSL z serwerem WebSocket
    webSocket.beginSSL("192.168.0.123", 81);   // host, port
    webSocket.onEvent(webSocketEvent);
}

void loop() {
    webSocket.loop();
}
